const mongoose = require('mongoose');
const bcrypt = require('bcrypt');
const userScheme = new mongoose.Schema({
  username: {
    type: String,
    required: [true, 'username is required'],
    min: 3,
    max: 15,
    unique: [true, 'username is unique'],
  },
  email: {
    type: String,
    required: [true, 'email is required'],
    unique: [true, 'email is unique'],
  },
  password: {
    type: String,
    required: [true, 'password is required'],
  },
  isAvatarImageSet: {
    type: Boolean,
    default: false,
  },
  avatarImage: {
    type: String,
    default:
      'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMzEgMjMxIj48cGF0aCBkPSJNMzMuODMsMzMuODNhMTE1LjUsMTE1LjUsMCwxLDEsMCwxNjMuMzQsMTE1LjQ5LDExNS40OSwwLDAsMSwwLTE2My4zNFoiIHN0eWxlPSJmaWxsOiMxZDhjMDA7Ii8+PHBhdGggZD0ibTExNS41IDUxLjc1YTYzLjc1IDYzLjc1IDAgMCAwLTEwLjUgMTI2LjYzdjE0LjA5YTExNS41IDExNS41IDAgMCAwLTUzLjcyOSAxOS4wMjcgMTE1LjUgMTE1LjUgMCAwIDAgMTI4LjQ2IDAgMTE1LjUgMTE1LjUgMCAwIDAtNTMuNzI5LTE5LjAyOXYtMTQuMDg0YTYzLjc1IDYzLjc1IDAgMCAwIDUzLjI1LTYyLjg4MSA2My43NSA2My43NSAwIDAgMC02My42NS02My43NSA2My43NSA2My43NSAwIDAgMC0wLjA5OTYxIDB6IiBzdHlsZT0iZmlsbDojZThiYzg2OyIvPjxwYXRoIGQ9Im0xNDEuNzUgMTk1YTExNC43OSAxMTQuNzkgMCAwIDEgMzggMTYuNSAxMTUuNTMgMTE1LjUzIDAgMCAxLTEyOC40NiAwIDExNC43OSAxMTQuNzkgMCAwIDEgMzgtMTYuNWMwIDEwLjc2IDExLjc1IDE5LjQ4IDI2LjI1IDE5LjQ4czI2LjI1LTguNzIgMjYuMjUtMTkuNDh6IiBzdHlsZT0iZmlsbDojMDAwOyIvPjxwYXRoIGQ9Im02OS44MzQgMzMuODI2Yy04LjIwMDEtMC4wNjI2LTE2LjQ0NCAyLjY3NTMtMjMuMTUyIDcuNzAzOC04LjUyOTggNi45ODk5LTEyLjE1OSAxOS42MS0xMi4zMjkgMzIuNjgtMC4yMDQxIDE1LjQ3NiAxLjYwOTIgMzQuNzUyIDEuNzQ2NCA1MS45MTUgMC4xMDQxNCAxMy4wNDcgMC41MzQ4NSAyNS45ODQtMi45MTk3IDMzLjk5NS0yLjQ5OTQgNS44MS05LjA5NTUgOS42MDA2LTE2LjE5NiAxMi4zMTEgNy45NTk5IDIuODMwMSAyNS4wMDkgMi44MDk0IDMzLjU4IDEuNTM5MyAxMC44LTEuNTkgMTcuMjM4LTYuNTI5NCAxNy4xNTktMjIuNjk5LTAuMDkxMS0xNS45My0xLjM4OTQtMjkuMjMtMS41NTktNDUuODMtMC4zMjA4LTExLjk4My0xLjU2OS0yNC4yOTEgNC45Nzc0LTMzLjk4NyA0LjIxMzktNi4xMjY1IDEwLjQ1Mi0xMC41MjEgMTcuMTE2LTEzLjU4OCAzLjkyOTItMS44NTc1IDguMDM4NC0zLjMwODMgMTIuMjYzLTQuMzI5Ny02Ljg3MTgtMTMuNTc0LTE4LjczMi0xOS42MTgtMzAuNjg3LTE5LjcwOXoiIHN0eWxlPSJmaWxsOiNmZmY1MTA7Ii8+PHBhdGggZD0ibTkwLjggNzYuMjQ2YzExLjkxOC0xNy4xMjUgMzEuOTk2LTIzLjIxOCA0OS43NDMtMTcuNDg4IDExLjgxIDMuOTQ5NiAyMC42OTIgMTMuMzg5IDIyLjMxMyAyOC4yMzcgMC41MTA1MSA2LjIwOTggMC42MzQxMyAxMi40NDUgMC4zNzAwNyAxOC42Ny0wLjIzOTczIDExLjItMC43Mjk0NiAyMy44Mi0xLjA5OTUgMzQuMDgtMC44MjAwNSAyMi40MyAwLjA1OTMgMzUuMSAyNC41ODkgMzYuMyA4LjU2MzUgMC4zMjEyMiAxNy4xMzctMC4yMjg0NSAyNS41OS0xLjY0MDVoLTAuMDE5OGMtMTAuNzQtMy4zNzk5LTE3Ljk4LTE1LjYwOS0xOS4zLTI2LjI4OS0xLjI5LTEwLjQxLTAuNjA5OC0yMy40My0wLjc4OTgtMzguMDkxLTAuMTcwMS0xNC45NiAxLjAzOTgtMjkuODE5IDAuMjgwMDgtNDIuMDg5LTEuNDE0LTIyLjc3Ny0xNC45NDctMzguNTA1LTM0LjEyNi00NS4xNTItMjcuODEzLTcuMzUtNTEuMDgzIDAuMDkxLTYxLjY3MiAxNy4zNDMtNS40Njk4IDguOTExMi03Ljc0MTMgMjAuMDctNS44Nzg4IDM2LjEyMXoiIHN0eWxlPSJmaWxsOiNmZmY1MTA7Ii8+PHBhdGggZD0ibTgzLjUyNyAxMDMuOTh2MTBoMTB2LTEwaC0xMHptNTMuOTQ1IDB2MTBoMTB2LTEwaC0xMHoiIHN0eWxlPSJmaWxsOiMwMDA7Ii8+PHBhdGggZD0ibTU2LjYyMSA5NC45MDZ2MTEuNjg4aDUuMzQxOHY2LjQ5MjJoNS4zNDE4djYuMTA1NWg1LjMyMjN2Ni4yMzI0aDI2Ljg0NnYtNi4yMzI0aDUuMzA0N3YtNi4xMDU1aDUuMTQ0NXYtNi4wMDM5aDExLjE1NHY2LjAwMzloNS4xNDQ2djYuMTA1NWg1LjMwNjZ2Ni4yMzI0aDI2Ljg0NnYtNi4yMzI0aDUuMzIwM3YtNi4xMDU1aDUuMzQzOHYtNi40OTIyaDUuMzQxOHYtMTEuNjg4eiIgc3R5bGU9ImZpbGw6bm9uZTsiLz48cGF0aCBkPSJtNjcuMzg3IDEwMC42NXY1LjkzOTRoNS4xOTkydi01LjkzOTR6bTUuMTk5MiA1LjkzOTR2Ni40OTIyaDUuNDIzOHYtNi40OTIyem01LjQyMzggMGg1LjE5OTJ2LTUuOTM5NGgtNS4xOTkyem01LjE5OTIgMHY2LjQ5MjJoNS40MjU4di02LjQ5MjJ6bTUuNDI1OCA2LjQ5MjJ2Ni4xMDU1aDUuMTQyNnYtNi4xMDU1em0tMTAuNjI1IDB2Ni4xMDU1aDUuMTQ0NXYtNi4xMDU1em00OC4yODEtMTIuNDMydjUuOTM5NGg1LjE5OTJ2LTUuOTM5NHptNS4xOTkyIDUuOTM5NHY2LjQ5MjJoNS40MjM4di02LjQ5MjJ6bTUuNDIzOCAwaDUuMTk5MnYtNS45Mzk0aC01LjE5OTJ6bTUuMTk5MiAwdjYuNDkyMmg1LjQyNTh2LTYuNDkyMnptNS40MjU4IDYuNDkyMnY2LjEwNTVoNS4xNDI2di02LjEwNTV6bS0xMC42MjUgMHY2LjEwNTVoNS4xNDQ1di02LjEwNTV6IiBzdHlsZT0iZmlsbDpub25lOyIvPjxwYXRoIGQ9Im0xMTUuNjggMTYwLjY0YzcuMDggMCAxMy4xMS00LjkzIDE1LjQ2LTExLjg0YTIuMTQgMi4xNCAwIDAgMC0xLjUxLTIuNjEwMSAyLjMgMi4zIDAgMCAwLTAuNzM5OTUtMC4wNTkzaC0yNi40MmEyLjEyIDIuMTIgMCAwIDAtMi4zMSAxLjkwOTkgMS44NSAxLjg1IDAgMCAwIDAuMDU5MyAwLjczOTk1YzIuMzQwMSA2LjkzMDEgOC4zODAyIDExLjg2IDE1LjQ2IDExLjg2eiIgc3R5bGU9ImZpbGw6I2ZmMDAwMDsiLz48L3N2Zz4=',
  },
});
//Query middlewares
userScheme.pre('save', async function (next) {
  if (!this.isModified('password')) return next();
  this.password = await bcrypt.hash(this.password, 12);
  next();
});

// Query Methods

userScheme.methods.correctPassword = async function (
  candidatepassword,
  userpassword,
) {
  return await bcrypt.compare(candidatepassword, userpassword);
};

const User = mongoose.model('User', userScheme);
module.exports = User;
